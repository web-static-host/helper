<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–º–æ—â–Ω–∏–∫ —Ç–µ—Ö–Ω–∞—Ä—è</title>
    <link rel="icon" type="image/png" href="icon.png">
    <script src="config.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f9; }
        .main-wrapper { display: flex; gap: 20px; max-width: 1600px; margin: auto; align-items: flex-start; }
        
        .column { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); min-height: 400px; }
        .col-left { flex: 2; }
        .col-mid { flex: 1; position: sticky; top: 20px; }
        .col-right { flex: 1; position: sticky; top: 20px; }

        h2 { margin-top: 0; color: #333; border-bottom: 1px solid #eee; padding-bottom: 15px; margin-bottom: 20px; }
        
        .search-box { margin-bottom: 20px; display: flex; gap: 10px; }
        input, select { padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
        input[type="text"] { flex-grow: 1; }
        
        button.primary-btn { padding: 10px 20px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; font-size: 16px; font-weight: bold; }
        button.primary-btn:hover { background: #0056b3; }

        .result-table { width: 100%; border-collapse: collapse; display: none; margin-top: 10px; }
        .result-table td { padding: 12px; border: 1px solid #ddd; font-size: 14px; }
        .result-table td:first-child { background: #f8f9fa; font-weight: bold; width: 35%; color: #555; }
        
        .tool-section { margin-bottom: 15px; }
        .tool-section summary { font-weight: bold; cursor: pointer; padding: 10px; background: #f8f9fa; border-radius: 4px; list-style: none; display: flex; justify-content: space-between; border: 1px solid #eee; }
        .tool-section summary::after { content: '‚ñº'; font-size: 10px; color: #888; }
        .tool-section[open] summary::after { content: '‚ñ≤'; }

        .links-list { list-style: none; padding: 5px 0 0 0; }
        .link-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid #f0f0f0; }
        .link-info { display: flex; flex-direction: column; overflow: hidden; }
        .link-name { color: #333; font-weight: 500; font-size: 13px; }
        .link-url { color: #888; font-size: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 150px; }
        
        .copy-btn { background: #eee; border: 1px solid #ccc; border-radius: 4px; padding: 3px 8px; cursor: pointer; font-size: 11px; }
        .copy-btn:hover { background: #ddd; }

        .astral-box { margin-top: 10px; padding: 10px; border: 1px solid #cfe2ff; border-radius: 4px; background: #f8faff; }
        .gen-row { margin: 10px 0; font-size: 14px; display: flex; align-items: center; gap: 10px; }
        #passResult { width: 100%; margin-top: 10px; font-family: monospace; font-weight: bold; text-align: center; background: #e9ecef; padding: 12px; border-radius: 4px; cursor: pointer; border: 1px dashed #6c757d; }

        pre { background: #272822; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px; max-height: 250px; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="column col-left">
        <h2>–†–µ–∫–≤–∏–∑–∏—Ç—ã –ø–æ –ò–ù–ù</h2>
        <div class="search-box">
            <input type="text" id="innInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ò–ù–ù">
            <button class="primary-btn" onclick="getData()">–ù–∞–π—Ç–∏</button>
        </div>
        <div id="errorBox" style="color:red; margin-bottom:10px;"></div>
        <table class="result-table" id="resTable"><tbody id="resBody"></tbody></table>
        <div id="rawContainer" style="display:none; margin-top:20px;">
            <details><summary style="cursor:pointer; color:#888; font-size:12px;">JSON –¥–∞–Ω–Ω—ã–µ</summary><pre id="rawData"></pre></details>
        </div>
    </div>

    <div class="column col-mid">
        <h2>–ü–æ–ª–µ–∑–Ω–æ–µ</h2>
        <details class="tool-section">
            <summary>–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Å—Å—ã–ª–∫–∏</summary>
            <div id="linksContainer" class="links-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </details>

        <details class="tool-section">
            <summary>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –û–§–î</summary>
            <div style="padding: 10px 0;">
                <div id="ofdLinksContainer" class="links-list" style="margin-bottom:10px;">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫...</div>
                
                <button onclick="toggleAstral()" style="width:100%; padding:8px; cursor:pointer; background:#6c757d; color:white; border:none; border-radius:4px;">–ü–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ê—Å—Ç—Ä–∞–ª –°–æ—Ñ—Ç</button>
                <div id="astralBox" class="astral-box" style="display:none;">
                    <p style="font-size:12px; margin:0 0 10px 0;">–ò–ù–ù: <b>4027145240</b> <button class="copy-btn" onclick="copyText('4027145240', this)">üìã</button></p>
                    <select id="staffSelect" style="width:100%;" onchange="showStaffEmail()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...</option>
                    </select>
                    <div id="staffEmailResult" style="margin-top:10px; font-size:13px;"></div>
                </div>
            </div>
        </details>
    </div>

    <div class="column col-right">
        <h2>–î–æ–ø –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h2>
        <details class="tool-section">
            <summary>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–∞—Ä–æ–ª–µ–π</summary>
            <div style="padding-top:10px;">
                <div class="gen-row">–î–ª–∏–Ω–∞: 
                    <select id="passLen">
                        <option value="6">6</option><option value="8" selected>8</option>
                        <option value="12">12</option><option value="16">16</option><option value="20">20</option>
                    </select>
                </div>
                <div class="gen-row"><input type="checkbox" id="genLower" checked> abc</div>
                <div class="gen-row"><input type="checkbox" id="genUpper" checked> ABC</div>
                <div class="gen-row"><input type="checkbox" id="genNum" checked> 123</div>
                <div class="gen-row"><input type="checkbox" id="genSym"> !@#</div>
                <button onclick="generatePass()" style="width:100%; padding:10px; cursor:pointer; background:#28a745; color:white; border:none; border-radius:4px; font-weight:bold;">–°–æ–∑–¥–∞—Ç—å –ø–∞—Ä–æ–ª—å</button>
                <div id="passResult" onclick="copyPass()">****</div>
            </div>
        </details>
    </div>
</div>

<script>
    // --- –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ---
    async function initAll() {
        loadLinks(GOOGLE_SHEET_CSV_URL, 'linksContainer');
        loadLinks(OFD_CONFIG_CSV_URL, 'ofdLinksContainer'); // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –û–§–î
        loadStaff();
    }

    async function loadLinks(url, targetId) {
        const container = document.getElementById(targetId);
        if (!url) { container.innerHTML = "–°—Å—ã–ª–∫–∞ –Ω–µ –∑–∞–¥–∞–Ω–∞"; return; }
        try {
            const response = await fetch(url);
            const data = await response.text();
            const rows = data.split(/\r?\n/).slice(1);
            container.innerHTML = rows.map(row => {
                const cols = row.split(/[,;](?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if (cols.length < 2) return '';
                const name = cols[0].replace(/"/g, '').trim();
                const val = cols[1].replace(/"/g, '').trim();
                return `<div class="link-item">
                    <div class="link-info"><span class="link-name">${name}</span><span class="link-url">${val}</span></div>
                    <button class="copy-btn" onclick="copyText('${val}', this)">üìã</button>
                </div>`;
            }).join('');
        } catch(e) { container.innerHTML = "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏"; }
    }

    let staffData = [];
    async function loadStaff() {
        if (typeof STAFF_CSV_URL === 'undefined' || !STAFF_CSV_URL) return;
        try {
            const response = await fetch(STAFF_CSV_URL);
            const data = await response.text();
            const rows = data.split(/\r?\n/).slice(1);
            const select = document.getElementById('staffSelect');
            rows.forEach(row => {
                const cols = row.split(/[,;](?=(?:(?:[^"]*"){2})*[^"]*$)/);
                if (cols.length >= 2) {
                    const name = cols[0].replace(/"/g, '').trim();
                    const email = cols[1].replace(/"/g, '').trim();
                    staffData.push({name, email});
                    let opt = document.createElement('option');
                    opt.value = email; opt.innerText = name;
                    select.appendChild(opt);
                }
            });
        } catch(e) {}
    }

    // --- –õ–û–ì–ò–ö–ê –ò–ù–¢–ï–†–§–ï–ô–°–ê ---
    function toggleAstral() {
        const box = document.getElementById('astralBox');
        box.style.display = box.style.display === 'none' ? 'block' : 'none';
    }

    function showStaffEmail() {
        const email = document.getElementById('staffSelect').value;
        const res = document.getElementById('staffEmailResult');
        res.innerHTML = email ? `–ü–æ—á—Ç–∞: <b id="targetEmail">${email}</b> <button class="copy-btn" onclick="copyText('${email}', this)">üìã</button>` : "";
    }

    function copyText(text, btn) {
        navigator.clipboard.writeText(text).then(() => {
            const old = btn.innerText; btn.innerText = "‚úÖ";
            setTimeout(() => btn.innerText = old, 1000);
        });
    }

    function generatePass() {
        const len = document.getElementById('passLen').value;
        const charset = (document.getElementById('genLower').checked ? "abcdefghijklmnopqrstuvwxyz" : "") +
                        (document.getElementById('genUpper').checked ? "ABCDEFGHIJKLMNOPQRSTUVWXYZ" : "") +
                        (document.getElementById('genNum').checked ? "0123456789" : "") +
                        (document.getElementById('genSym').checked ? "!@#$%^&*()_+" : "");
        if (!charset) return;
        let res = "";
        for (let i = 0; i < len; i++) res += charset.charAt(Math.floor(Math.random() * charset.length));
        document.getElementById('passResult').innerText = res;
    }

    function copyPass() {
        const p = document.getElementById('passResult').innerText;
        if (p !== "****") copyText(p, document.getElementById('passResult'));
    }

    async function getData() {
        const inn = document.getElementById('innInput').value.trim();
        const body = document.getElementById('resBody');
        const errorBox = document.getElementById('errorBox');
        if (!inn) return;
        errorBox.innerText = "";
        try {
            const response = await fetch("https://suggestions.dadata.ru/suggestions/api/4_1/rs/findById/party", {
                method: "POST", headers: { "Content-Type": "application/json", "Accept": "application/json", "Authorization": "Token " + API_KEY },
                body: JSON.stringify({query: inn})
            });
            const result = await response.json();
            if (result.suggestions?.length > 0) {
                const d = result.suggestions[0].data;
                document.getElementById('rawData').innerText = JSON.stringify(result, null, 2);
                document.getElementById('rawContainer').style.display = 'block';
                const fields = [
                    ["–ò–ù–ù", d.inn], ["–ö–ü–ü", d.kpp], ["–û–ì–†–ù", d.ogrn], ["–û–ö–ü–û", d.okpo],
                    ["–ü–æ–ª–Ω–æ–µ –∏–º—è", d.name?.full_with_opf], ["–°–æ–∫—Ä. –∏–º—è", d.name?.short_with_opf],
                    ["–ê–¥—Ä–µ—Å", d.address?.value], ["–û–ö–í–≠–î", d.okved],
                    ["–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å", d.management?.name || result.suggestions[0].value],
                    ["–ò–§–ù–° –¢–µ—Ä—Ä.", d.tax_authority?.name], ["–ò–§–ù–° –†–µ–≥.", d.registration_authority?.name],
                    ["–ö–æ–¥ –°–§–†", d.sfr_registration_number]
                ];
                body.innerHTML = fields.map(f => `<tr><td>${f[0]}</td><td>${f[1] || "‚Äî"}</td></tr>`).join("");
                document.getElementById('resTable').style.display = 'table';
            } else { errorBox.innerText = "–ù–µ –Ω–∞–π–¥–µ–Ω–æ"; }
        } catch (e) { errorBox.innerText = "–û—à–∏–±–∫–∞ API"; }
    }

    initAll();
</script>
</body>
</html>